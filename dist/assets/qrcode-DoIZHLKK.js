import{H as d,J as r}from"./firebase-vendor-V7RN5xDf.js";import{o as c,s as u}from"./firebase-auth-CkiyymQV.js";import"./firebase-app-J8-aw7xu.js";import{a as m,d as h}from"./firebase-firestore-BwGYsYUu.js";import"./vendor-Bg_btqvK.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function t(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(e){if(e.ep)return;e.ep=!0;const a=t(e);fetch(e.href,a)}})();const f=window.location.pathname.includes("index.html")||window.location.pathname.endsWith("/")||window.location.pathname==="/"||window.location.href.includes("index.html");if(!f&&!window.__authGuardInitialized){window.__authGuardInitialized=!0;let s=!1,n=!1;c(r,async t=>{if(!s){if(!t){s=!0;const o=window.location.pathname.includes("/dist/")?"/index.html":window.location.pathname.includes("/dashboard/")||window.location.pathname.includes("/assets/")||window.location.pathname.includes("/maintenance/")||window.location.pathname.includes("/inspection/")||window.location.pathname.includes("/qrcode/")?"../index.html":"./index.html";setTimeout(()=>{window.location.pathname.includes("index.html")||window.location.replace(o)},100);return}if(!n&&!sessionStorage.getItem("userRole")){n=!0;try{const o=await m(h(d,"users",t.uid));if(o.exists()){const e=o.data(),a=e.role||"user";console.log("User role:",a),sessionStorage.setItem("userRole",a),sessionStorage.setItem("userName",e.fullName||t.email)}}catch(o){console.error("Error loading user data:",o)}}}})}function p(){const s=document.getElementById("sidebar"),n=document.getElementById("sidebar-toggle-btn"),t=document.getElementById("toggle-icon");if(!s||!n||!t)return;localStorage.getItem("sidebarCollapsed")==="true"?(s.classList.add("collapsed"),t.textContent="→"):t.textContent="☰",n.addEventListener("click",e=>{e.stopPropagation(),e.preventDefault(),s.classList.toggle("collapsed"),s.classList.contains("collapsed")?(t.textContent="→",localStorage.setItem("sidebarCollapsed","true")):(t.textContent="☰",localStorage.setItem("sidebarCollapsed","false"));const a=document.querySelector(".app-shell");a&&(s.classList.contains("collapsed")?a.classList.add("has-collapsed-sidebar"):a.classList.remove("has-collapsed-sidebar"))})}function g(){const s=document.getElementById("user-name"),n=document.getElementById("user-avatar");!s&&!n||c(r,async t=>{if(t)try{let o=t.email||"User";const e=await m(h(d,"users",t.uid));if(e.exists()){const a=e.data();o=a.fullName||a.name||t.email||"User"}if(s&&(s.textContent=o),n){const a=o.trim().charAt(0).toUpperCase();n.textContent=a||"U"}}catch(o){console.error("Error loading user data for header:",o);const e=t.displayName||t.email||"User";if(s&&(s.textContent=e),n){const a=e.trim().charAt(0).toUpperCase();n.textContent=a||"U"}}})}function w(){const s=document.getElementById("logout-btn");s&&s.addEventListener("click",async()=>{try{await u(r);const n=window.location.pathname;let t="/index.html";n.includes("/dashboard/")||n.includes("/assets/")||n.includes("/maintenance/")||n.includes("/inspection/")||n.includes("/qrcode/")?t="../index.html":n.includes("/dist/")?t="/index.html":t="./index.html",window.location.replace(t)}catch(n){console.error("Logout error:",n),alert("Error logging out. Please try again.")}})}function l(){document.querySelectorAll(".sidebar-nav .nav-item[href]").forEach(n=>{const t=n.getAttribute("href");if(t&&!t.startsWith("/")&&!t.startsWith("http")){const o=window.location.pathname;let e=t;o.includes("/dashboard/")?t==="dashboard.html"?e="./dashboard.html":t==="asset.html"?e="../assets/asset.html":t==="maintenance.html"?e="../maintenance/maintenance.html":t==="qrcode.html"&&(e="../qrcode/qrcode.html"):o.includes("/assets/")?t==="dashboard.html"?e="../dashboard/dashboard.html":t==="asset.html"?e="./asset.html":t==="maintenance.html"?e="../maintenance/maintenance.html":t==="qrcode.html"&&(e="../qrcode/qrcode.html"):o.includes("/maintenance/")?t==="dashboard.html"?e="../dashboard/dashboard.html":t==="asset.html"?e="../assets/asset.html":t==="maintenance.html"?e="./maintenance.html":t==="qrcode.html"&&(e="../qrcode/qrcode.html"):o.includes("/qrcode/")&&(t==="dashboard.html"?e="../dashboard/dashboard.html":t==="asset.html"?e="../assets/asset.html":t==="maintenance.html"?e="../maintenance/maintenance.html":t==="qrcode.html"&&(e="./qrcode.html")),e!==t&&n.setAttribute("href",e)}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l();function b(){p(),g(),w(),l()}b();function y(){console.log("QR Code page initialized")}y();
