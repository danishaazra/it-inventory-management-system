import"./qrcode-DEXsfuzH.js";import{H as h,J as P}from"./firebase-vendor-B2UDLW_X.js";import{onAuthStateChanged as T}from"./firebase-auth-CnPx9bWP.js";import"./firebase-app-D-fiV83C.js";import{getDoc as v,doc as g}from"./firebase-firestore-BFWK-5cG.js";import"./vendor-BdN5Q6dY.js";const S=document.getElementById("user-name"),k=document.getElementById("user-avatar"),A=document.getElementById("back-link"),L=document.getElementById("summary-asset-id"),M=document.getElementById("summary-category"),U=document.getElementById("summary-location"),R=document.getElementById("summary-status"),w=document.getElementById("asset-spec-list"),i=document.getElementById("inspection-section"),y=document.getElementById("inspection-details-list");let D=null,x=null,b=null,V=null,e=null;T(P,async t=>{if(t)try{let a=t.email||"User";const p=await v(g(h,"users",t.uid));if(p.exists()){const c=p.data();a=c.fullName||c.name||t.email||"User"}if(S&&(S.textContent=a),k){const c=a.trim().charAt(0).toUpperCase();k.textContent=c||"U"}}catch(a){console.error("Error loading user data:",a)}});async function O(){const t=new URLSearchParams(window.location.search),a=t.get("maintenanceId"),p=parseInt(t.get("taskIndex")||"0"),c=t.get("assetId");if(!a||!c){alert("Missing required parameters."),window.location.replace("/maintenance/maintenance.html");return}D=a,x=p,b=c;try{const n=await v(g(h,"maintenance",a));if(!n.exists()){alert("Maintenance item not found."),window.location.replace("/maintenance/maintenance.html");return}V=n.data();const d=await v(g(h,"assets",c));if(!d.exists()){alert("Asset not found."),window.location.replace("/maintenance/maintenance.html");return}e=d.data(),A&&(A.href=`/inspection/inspectionassets.html?maintenanceId=${encodeURIComponent(a)}&taskIndex=${p}`),L&&(L.textContent=e.assetId||"Not set"),M&&(M.textContent=e.assetCategoryDescription||e.assetCategory||"Not set"),U&&(U.textContent=e.locationDescription||e.location||"Not set"),R&&(R.textContent=e.status||"Not set");const u=[{label:"Asset Description",value:e.assetDescription},{label:"Model",value:e.model},{label:"Brand",value:e.brand},{label:"Serial No.",value:e.serialNo},{label:"Owner",value:e.ownerName||e.ownerCode},{label:"Area",value:e.area},{label:"Condition",value:e.condition}];w&&(w.innerHTML="",u.forEach(r=>{const s=document.createElement("div");s.className="spec-row";const o=document.createElement("div");o.className="spec-label",o.textContent=r.label;const l=document.createElement("div");if(l.className="spec-value",r.value)l.textContent=r.value;else{const m=document.createElement("span");m.className="muted",m.textContent="Not set",l.appendChild(m)}s.appendChild(o),s.appendChild(l),w.appendChild(s)})),await $()}catch(n){console.error("Error loading asset details:",n),alert("Failed to load asset details. Please try again."),window.location.replace("/maintenance/maintenance.html")}}async function $(){if(!D||x===null||!b){i&&(i.style.display="none");return}try{const t=await v(g(h,"maintenance",D));if(!t.exists()){i&&(i.style.display="none");return}const n=((t.data().inspectionData||{})[x]||{})[b]||null;if(!n){i&&(i.style.display="none");return}if(i&&(i.style.display="block"),y){y.innerHTML="";const d=document.createElement("div");d.className="spec-row";const u=document.createElement("div");u.className="spec-label",u.textContent="Status";const r=document.createElement("div");r.className="spec-value";const s=document.createElement("span");s.className="status-badge",n.solved==="yes"?(s.className+=" status-complete",s.textContent="Complete"):(s.className+=" status-open",s.textContent="Open"),r.appendChild(s),d.appendChild(u),d.appendChild(r),y.appendChild(d);const o=document.createElement("div");o.className="spec-row",o.style.flexDirection="column",o.style.alignItems="flex-start";const l=document.createElement("div");l.className="spec-label",l.textContent="Description / Notes",l.style.marginBottom="0.5rem";const m=document.createElement("div");m.className="spec-value",m.style.width="100%";const E=document.createElement("div");if(E.className="inspection-notes",E.textContent=n.notes||"No notes provided",m.appendChild(E),o.appendChild(l),o.appendChild(m),y.appendChild(o),n.timestamp||n.updatedAt){const C=document.createElement("div");C.className="spec-row";const I=document.createElement("div");I.className="spec-label",I.textContent="Inspection Date";const N=document.createElement("div");N.className="spec-value";const f=document.createElement("span");f.className="inspection-timestamp";const B=n.updatedAt||n.timestamp;if(B){const H=new Date(B).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});f.textContent=H}else f.textContent="Not available";N.appendChild(f),C.appendChild(I),C.appendChild(N),y.appendChild(C)}}}catch(t){console.error("Error loading inspection details:",t),i&&(i.style.display="none")}}O();
