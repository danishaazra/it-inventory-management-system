import"./qrcode-_3APf9r8.js";import{H as v,J as H}from"./firebase-vendor-BDhSju_T.js";import{o as V,s as $}from"./firebase-auth-V8RQ8eEz.js";import"./firebase-app-CdRXrjY0.js";import{getDoc as E,doc as I}from"./firebase-firestore-DyzXcozE.js";import"./vendor-BdN5Q6dY.js";const k=document.getElementById("user-name"),A=document.getElementById("user-avatar"),M=document.getElementById("back-link"),U=document.getElementById("summary-asset-id"),P=document.getElementById("summary-category"),R=document.getElementById("summary-location"),T=document.getElementById("summary-status"),N=document.getElementById("asset-spec-list"),i=document.getElementById("inspection-section"),f=document.getElementById("inspection-details-list");let D=null,L=null,S=null,F=null,t=null;V(H,async e=>{if(e)try{let a=e.email||"User";const d=await E(I(v,"users",e.uid));if(d.exists()){const n=d.data();a=n.fullName||n.name||e.email||"User"}if(k&&(k.textContent=a),A){const n=a.trim().charAt(0).toUpperCase();A.textContent=n||"U"}}catch(a){console.error("Error loading user data:",a)}});async function J(){const e=new URLSearchParams(window.location.search),a=e.get("maintenanceId"),d=parseInt(e.get("taskIndex")||"0"),n=e.get("assetId");if(!a||!n){alert("Missing required parameters."),window.location.href="maintenance.html";return}D=a,L=d,S=n;try{const s=await E(I(v,"maintenance",a));if(!s.exists()){alert("Maintenance item not found."),window.location.href="maintenance.html";return}F=s.data();const u=await E(I(v,"assets",n));if(!u.exists()){alert("Asset not found."),window.location.href="maintenance.html";return}t=u.data(),M&&(M.href=`inspectionassets.html?maintenanceId=${encodeURIComponent(a)}&taskIndex=${d}`),U&&(U.textContent=t.assetId||"Not set"),P&&(P.textContent=t.assetCategoryDescription||t.assetCategory||"Not set"),R&&(R.textContent=t.locationDescription||t.location||"Not set"),T&&(T.textContent=t.status||"Not set");const g=[{label:"Asset Description",value:t.assetDescription},{label:"Model",value:t.model},{label:"Brand",value:t.brand},{label:"Serial No.",value:t.serialNo},{label:"Owner",value:t.ownerName||t.ownerCode},{label:"Area",value:t.area},{label:"Condition",value:t.condition}];N&&(N.innerHTML="",g.forEach(y=>{const o=document.createElement("div");o.className="spec-row";const c=document.createElement("div");c.className="spec-label",c.textContent=y.label;const r=document.createElement("div");if(r.className="spec-value",y.value)r.textContent=y.value;else{const m=document.createElement("span");m.className="muted",m.textContent="Not set",r.appendChild(m)}o.appendChild(c),o.appendChild(r),N.appendChild(o)})),await j()}catch(s){console.error("Error loading asset details:",s),alert("Failed to load asset details. Please try again."),window.location.href="maintenance.html"}}async function j(){if(!D||L===null||!S){i&&(i.style.display="none");return}try{const e=await E(I(v,"maintenance",D));if(!e.exists()){i&&(i.style.display="none");return}const s=((e.data().inspectionData||{})[L]||{})[S]||null;if(!s){i&&(i.style.display="none");return}if(i&&(i.style.display="block"),f){f.innerHTML="";const u=document.createElement("div");u.className="spec-row";const g=document.createElement("div");g.className="spec-label",g.textContent="Status";const y=document.createElement("div");y.className="spec-value";const o=document.createElement("span");o.className="status-badge",s.solved==="yes"?(o.className+=" status-complete",o.textContent="Complete"):(o.className+=" status-open",o.textContent="Open"),y.appendChild(o),u.appendChild(g),u.appendChild(y),f.appendChild(u);const c=document.createElement("div");c.className="spec-row",c.style.flexDirection="column",c.style.alignItems="flex-start";const r=document.createElement("div");r.className="spec-label",r.textContent="Description / Notes",r.style.marginBottom="0.5rem";const m=document.createElement("div");m.className="spec-value",m.style.width="100%";const b=document.createElement("div");if(b.className="inspection-notes",b.textContent=s.notes||"No notes provided",m.appendChild(b),c.appendChild(r),c.appendChild(m),f.appendChild(c),s.timestamp||s.updatedAt){const h=document.createElement("div");h.className="spec-row";const w=document.createElement("div");w.className="spec-label",w.textContent="Inspection Date";const x=document.createElement("div");x.className="spec-value";const C=document.createElement("span");C.className="inspection-timestamp";const B=s.updatedAt||s.timestamp;if(B){const O=new Date(B).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});C.textContent=O}else C.textContent="Not available";x.appendChild(C),h.appendChild(w),h.appendChild(x),f.appendChild(h)}}}catch(e){console.error("Error loading inspection details:",e),i&&(i.style.display="none")}}J();document.getElementById("logout-btn").addEventListener("click",async()=>{try{await $(H),window.location.href="index.html"}catch(e){console.error("Logout error:",e),alert("Error logging out. Please try again.")}});const p=document.getElementById("sidebar"),q=document.getElementById("sidebar-toggle-btn"),l=document.getElementById("toggle-icon");if(p&&q&&l){localStorage.getItem("sidebarCollapsed")==="true"?(p.classList.add("collapsed"),l.textContent="→"):l.textContent="☰",q.addEventListener("click",d=>{d.stopPropagation(),d.preventDefault(),p.classList.contains("collapsed"),l.style.opacity="0",l.style.transform="scale(0.8)",setTimeout(()=>{p.classList.toggle("collapsed"),p.classList.contains("collapsed")?l.textContent="→":l.textContent="☰",setTimeout(()=>{l.style.opacity="1",l.style.transform="scale(1)"},50);const n=document.querySelector(".app-shell");n&&(p.classList.contains("collapsed")?n.classList.add("has-collapsed-sidebar"):n.classList.remove("has-collapsed-sidebar")),localStorage.setItem("sidebarCollapsed",p.classList.contains("collapsed")?"true":"false")},150)});const a=document.querySelector(".app-shell");a&&p.classList.contains("collapsed")&&a.classList.add("has-collapsed-sidebar"),l.style.opacity="1",l.style.transform="scale(1)"}
