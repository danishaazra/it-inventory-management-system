const L=(e,t)=>t.some(r=>e instanceof r);let B,P;function S(){return B||(B=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function k(){return P||(P=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const j=new WeakMap,m=new WeakMap,M=new WeakMap,l=new WeakMap,b=new WeakMap;function C(e){const t=new Promise((r,n)=>{const o=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{r(d(e.result)),o()},i=()=>{n(e.error),o()};e.addEventListener("success",s),e.addEventListener("error",i)});return t.then(r=>{r instanceof IDBCursor&&j.set(r,e)}).catch(()=>{}),b.set(t,e),t}function T(e){if(m.has(e))return;const t=new Promise((r,n)=>{const o=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{r(),o()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});m.set(e,t)}let w={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return m.get(e);if(t==="objectStoreNames")return e.objectStoreNames||M.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return d(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function V(e){w=e(w)}function A(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const n=e.call(y(this),t,...r);return M.set(n,t.sort?t.sort():[t]),d(n)}:k().includes(e)?function(...t){return e.apply(y(this),t),d(j.get(this))}:function(...t){return d(e.apply(y(this),t))}}function W(e){return typeof e=="function"?A(e):(e instanceof IDBTransaction&&T(e),L(e,S())?new Proxy(e,w):e)}function d(e){if(e instanceof IDBRequest)return C(e);if(l.has(e))return l.get(e);const t=W(e);return t!==e&&(l.set(e,t),b.set(t,e)),t}const y=e=>b.get(e);function K(e,t,{blocked:r,upgrade:n,blocking:o,terminated:s}={}){const i=indexedDB.open(e,t),u=d(i);return n&&i.addEventListener("upgradeneeded",c=>{n(d(i.result),c.oldVersion,c.newVersion,d(i.transaction),c)}),r&&i.addEventListener("blocked",c=>r(c.oldVersion,c.newVersion,c)),u.then(c=>{s&&c.addEventListener("close",()=>s()),o&&c.addEventListener("versionchange",a=>o(a.oldVersion,a.newVersion,a))}).catch(()=>{}),u}const F=["get","getKey","getAll","getAllKeys","count"],N=["put","add","delete","clear"],_=new Map;function g(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(_.get(t))return _.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,o=N.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(o||F.includes(r)))return;const s=async function(i,...u){const c=this.transaction(i,o?"readwrite":"readonly");let a=c.store;return n&&(a=a.index(u.shift())),(await Promise.all([a[r](...u),o&&c.done]))[0]};return _.set(t,s),s}V(e=>({...e,get:(t,r,n)=>g(t,r)||e.get(t,r,n),has:(t,r)=>!!g(t,r)||e.has(t,r)}));function Q(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r}var O={exports:{}};(function(e){var t={single_source_shortest_paths:function(r,n,o){var s={},i={};i[n]=0;var u=t.PriorityQueue.make();u.push(n,0);for(var c,a,f,D,p,v,h,E,I;!u.empty();){c=u.pop(),a=c.value,D=c.cost,p=r[a]||{};for(f in p)p.hasOwnProperty(f)&&(v=p[f],h=D+v,E=i[f],I=typeof i[f]>"u",(I||E>h)&&(i[f]=h,u.push(f,h),s[f]=a))}if(typeof o<"u"&&typeof i[o]>"u"){var x=["Could not find a path from ",n," to ",o,"."].join("");throw new Error(x)}return s},extract_shortest_path_from_predecessor_list:function(r,n){for(var o=[],s=n;s;)o.push(s),r[s],s=r[s];return o.reverse(),o},find_path:function(r,n,o){var s=t.single_source_shortest_paths(r,n,o);return t.extract_shortest_path_from_predecessor_list(s,o)},PriorityQueue:{make:function(r){var n=t.PriorityQueue,o={},s;r=r||{};for(s in n)n.hasOwnProperty(s)&&(o[s]=n[s]);return o.queue=[],o.sorter=r.sorter||n.default_sorter,o},default_sorter:function(r,n){return r.cost-n.cost},push:function(r,n){var o={value:r,cost:n};this.queue.push(o),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};e.exports=t})(O);var R=O.exports;export{Q as _,R as d,K as o};
